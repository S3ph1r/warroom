{
    "PROMPT_REGEX_DISCOVERY": "Sei un Data Scientist. Analizza il testo e crea regex python per estrarre transazioni.\n\nSAMPLE TEXT:\n{content}\n\nOBIETTIVO:\nCatturare DATA, TICKER (PULITISSIMO), TIPO, QUANTITA, PREZZO.\n\nCRITICO:\n1. IGNORA LE RIGHE DI INTESTAZIONE! (Es. 'Tipo Nomeprodotto', 'Generata il'). Usa `(?!Tipo|Nome|Generata|Periodo)`.\n2. IL TICKER NON DEVE INCLUDERE 'Contrattazione'.\n\nSTRUTTURA REGEX:\n`(?P<date>\\d{{2}}-\\w{{3}}-\\d{{4}})\\s+(?!Generata|Periodo|Pagina)(?:.{{0,50}}?)(?!Tipo|Nomeprodotto)(?:Contrattazione\\s+)?(?P<ticker>(?!Tipo)[A-Z0-9][\\w\\.\\s\\-]+?)\\s+(?P<type>Acquista|Vendi|Dividendoincontanti)...`\n\nESEMPI REGEX:\n1. Trading: `(?P<date>\\d{{2}}-\\w{{3}}-\\d{{4}})\\s+(?!Generata|Periodo)(?:.{{0,50}}?)(?:Contrattazione\\s+)?(?P<ticker>[A-Z0-9][\\w\\.\\s]+?)\\s+(?P<type>Acquista|Vendi)\\s*(?P<qty>-?\\d+(?:[.,]\\d+)?)@(?P<price>[\\d.,]+)(?:.{{0,150}}?(?P<isin>[A-Z0-9]{{12}}))?`\n2. Dividendi: `(?P<date>\\d{{2}}-\\w{{3}}-\\d{{4}})\\s+(?!Generata)(?:.{{0,50}}?)(?:Operazionesulcapitale\\s+)?(?P<ticker>[A-Z0-9][\\w\\.\\s]+?)\\s+(?P<type>Dividendoincontanti)\\s*(?P<price>[\\d.,]+)`\n\nOUTPUT JSON:\n{{\n  \"patterns\": [\n    {{\"name\": \"Trading\", \"regex\": \"...\"}},\n    {{\"name\": \"Dividendi\", \"regex\": \"...\"}}\n  ]\n}}",
    "PROMPT_CSV_ANALYSIS": "Sei un analista finanziario. Analizza questo CSV e estrai le Holdings.\n\nCSV CONTENT:\n{content}\n\nTASK:\nRestituisci una lista JSON.\nCampi richiesti: name, ticker (se presente, altrimenti usa parte del nome), isin (se presente), quantity, currency, current_price, cost_basis (prezzo acquisto), asset_type.\n\nLOGICA ASSET_TYPE:\n- Se il nome contiene 'ETF', 'UCITS', asset_type='ETF'.\n- Se è un'azione (es. Enel, Stellantis), asset_type='STOCK'.\n- Se è un'obbligazione, asset_type='BOND'.\n- Default: 'STOCK'.\n\nOUTPUT JSON:\n[\n  {{ \"name\": \"Nome Strumento\", \"ticker\": \"TICK\", \"isin\": \"IT000...\", \"quantity\": 100, \"currency\": \"EUR\", \"asset_type\": \"STOCK\", \"current_price\": 10.50 }}\n]",
    "PROMPT_CSV_RULE_DISCOVERY": "You are a Data Engineer. Your job is to analyze a CSV sample and generate a JSON configuration to parse it.\n\nCRITICAL INSTRUCTION:\nYou must use the **EXACT COLUMN NAMES** found in the CSV. Do NOT invent English headers if the CSV is in Italian or another language.\nScan the text to find the Header Row. Extract those strings exactly.\n\nTASK:\n1. Identify the **Header Row Index** (0-indexed).\n2. Identify the **Separator** (comma, semicolon, tab).\n3. Map the **EXACT FOUND HEADERS** to Standard Fields: ['ticker', 'name', 'isin', 'quantity', 'currency', 'price', 'asset_type'].\n   - 'Strumento' -> 'name'\n   - 'Quantità' -> 'quantity'\n   - 'Valuta' -> 'currency'\n4. Identify a **Filter Condition** (e.g., column 'ISIN' not empty).\n\nCSV SAMPLE (First 50 lines):\n{content}\n\nOUTPUT FORMAT (JSON ONLY):\n{{\n  \"header_row\": 0,\n  \"sep\": \",\",\n  \"mapping\": {{\n    \"Strumento\": \"name\",\n    \"Valuta\": \"currency\"\n  }},\n  \"filter_column\": \"ISIN\",\n  \"notes\": \"Found Italian headers...\"\n}}\n",
    "PROMPT_PDF_RULE_DISCOVERY": "You are a Document Layout Analyst. Your goal is to reverse-engineer the structure of this financial PDF export.\nCRITICAL WARNING: The PDF extraction often CONCATENATES words (e.g., 'Dividendoincontanti').\n\n**OBJECTIVE**:\nIdentify patterns to split and parse 'Transaction Blocks'.\n\n**ANALYSIS STEPS**:\n1.  **Block Boundaries**: \n    -   Identify the keyword that STARTS a new transaction block (e.g., 'Contrattazione').\n    -   **CRITICAL**: This keyword MUST be at the BEGINNING of the line. Your regex MUST start with `^` to avoid matching it in the middle of a description.\n2.  **Date Headers**: Find the date section headers (e.g., '28-nov-2024').\n3.  **Data Extraction**:\n    -   **Type**: Regex to extract the type identifier.\n    -   **Product**: Regex to extract product name. Handle concatenation!\n    -   **ISIN**: Regex for ISIN code (US... or IT...).\n    -   **Amount**: Regex for the transaction amount (last number in the block?).\n\n**OUTPUT JSON**:\n{{\n  \"transaction_start_regex\": \"Regex for block start (MUST use ^)\",\n  \"date_trigger_regex\": \"Regex for date headers\",\n  \"field_extractors\": {{\n      \"type_classifier\": {{ \"regex\": \"...\" }},\n      \"product_name\": {{ \"regex\": \"...\" }},\n      \"isin\": {{ \"regex\": \"...\" }},\n      \"amount\": {{ \"regex\": \"...\" }}\n  }}\n}}"
}